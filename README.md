# Convolution Approximations
This repository contains code to apply the approximations to weight tensors.

## compress\_conv

This folder contains matlab code to compute the decompositions described in the paper Exploiting Linear Structure Within Convolutional Networks for Efficient Evaluation.
Corresponding paper available [here](https://arxiv.org/pdf/1404.0736v2.pdf).  Download code [here](https://cs.nyu.edu/~denton/).

Decomposition functions:
- monochromatic\_approx.m
- bisubspace\_lowrank\_approx.m
- bisubspace\_svd\_example.lua

Examples of use:
- monochromatic\_example.m
- bisubspace\_lowrank\_example.m
- bisubspace\_svd\_example.lua

Note that the approximation in the example scripts will be terrible since the weights are initialized to be random (out method relies on the structure inherent in trained convolutional network weights).

## dump\_parser

Receives a textual representation of a flatbuffer (.tflite) generated by [neural-network-transpiler](https://gitlab.com/LEDLGroup/neural-network-transpiler.git) and converts it to a pickle file.
With the pickle file it can reconstruct the flatbuffer or apply an approximation and then reconstruct the flatbuffer.

### Requirements

- libmagic-dev
    - `sudo apt-get install libmagic-dev`
- python-libmagic
    - `pip install python-libmagic`

### Instructions

#### Dump flatbuffer weigths with nnt
- Compile [neural-network-transpiler](https://gitlab.com/LEDLGroup/neural-network-transpiler.git)
- Generate the weigths dump
    - `./nnt -w -m [MODEL.tflite] > out-nnt.txt`

#### Convert dump text to pickle file
- `./dump_parser out-nnt.txt`
- It will generate a .pkl file, for example 'out-nnt.pkl'

#### Rebuild flatbuffer from pickle file
- `./flatbuffer_rebuilder.py -m out-nnt.pkl`
- It will generate a .tflite file, for example 'reconstructed\_out-nnt.tflite

#### Test rebuilt model
- `./xorapu.py -m reconstructed_out-nnt.tflite -l /path/to/labels/file -i /path/to/dataset/directory`
- This tests the accuracy of the reconstructed model
- After having performed this step once, you can test a rebuilt model immediately after reconstructing it by simply passing the `-x` flag to `flatbuffer_rebuilder`

## py\_ver
Python/NumPy implementation of the (originally MatLab) code in [compress\_conv](./compress_conv).
*Work in progress*
